(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{19:function(e,t,s){},48:function(e,t,s){},49:function(e,t,s){},54:function(e,t,s){},58:function(e,t,s){},99:function(e,t,s){"use strict";s.r(t);s(47),s(19),s(48),s(49);var a=s(1),o=s(10),n=s.n(o),r=s(104),c=(s(54),s(0));function l(e){let{onLogIn:t,onSignup:s}=e;const[o,n]=Object(a.useState)("naqib3110@gmail.com"),[l,i]=Object(a.useState)("2C*GZ8Z*6#z%aah"),[d,m]=Object(a.useState)(null);return Object(c.jsx)(c.Fragment,{children:Object(c.jsx)("div",{className:"login-form text-center login-page",children:Object(c.jsxs)("div",{className:"rounded",style:{boxShadow:"0 0.75rem 1.5rem rgba(18,38,63,.03)"},children:[Object(c.jsxs)("div",{className:"position-relative",children:[Object(c.jsxs)("div",{className:"row no-gutters align-items-center",style:{maxWidth:400,backgroundColor:"rgba(85, 110, 230, 0.25)",paddingLeft:20,paddingRight:20,borderTopLeftRadius:4,borderTopRightRadius:4},children:[Object(c.jsxs)("div",{className:"col text-primary text-left",children:[Object(c.jsx)("h3",{className:"font-size-15",children:"Welcome Back !"}),Object(c.jsx)("p",{children:"Sign in to continue"})]}),Object(c.jsx)("div",{className:"col align-self-end",children:Object(c.jsx)("img",{alt:"welcome back",style:{maxWidth:"100%"},src:"".concat("","/welcome-back.png")})})]}),Object(c.jsx)("div",{className:"position-absolute",style:{bottom:-36,left:20},children:Object(c.jsx)("div",{style:{backgroundColor:"rgb(239, 242, 247)",width:72,height:72},className:"rounded-circle d-flex align-items-center justify-content-center"})})]}),Object(c.jsxs)("form",{className:"bg-white text-left px-4",style:{paddingTop:58,borderBottomLeftRadius:4,borderBottomRightRadius:4},onSubmit:async e=>{e.preventDefault(),t(o,l,m)},children:[Object(c.jsx)("label",{className:"font-size-12",children:"Name"}),Object(c.jsx)("div",{className:"username-select mb-3",children:Object(c.jsx)("input",{value:o,onChange:e=>n(e.target.value),type:"username",id:"inputUsername",className:"form-control",placeholder:"Email",required:!0})}),Object(c.jsx)("label",{htmlFor:"inputPassword",className:"font-size-12",children:"Password"}),Object(c.jsx)("input",{value:l,onChange:e=>i(e.target.value),type:"password",id:"inputPassword",className:"form-control",placeholder:"Password",required:!0}),Object(c.jsx)("div",{style:{height:30}}),Object(c.jsx)("button",{className:"btn btn-lg btn-primary btn-block",type:"submit",children:"Sign in"}),Object(c.jsx)("div",{className:"login-error-anchor",children:Object(c.jsx)("div",{className:"toast-box",children:Object(c.jsxs)(r.a,{style:{minWidth:277},onClose:()=>m(null),show:null!==d,delay:3e3,autohide:!0,children:[Object(c.jsxs)(r.a.Header,{children:[Object(c.jsx)("img",{src:"holder.js/20x20?text=%20",className:"rounded mr-2",alt:""}),Object(c.jsx)("strong",{className:"mr-auto",children:"Error"})]}),Object(c.jsx)(r.a.Body,{children:d})]})})}),Object(c.jsx)("div",{style:{height:30}})]}),Object(c.jsx)("button",{className:"btn btn-lg btn-info btn-block",type:"button",onClick:async e=>{e.preventDefault(),s(o,l,m),console.log(d,m)},children:"Sign Up"})]})})})}s(58);const i=(e,t)=>{switch(t.type){case"clear":return{currentRoom:"0",rooms:{},users:{}};case"set user":return{...e,users:{...e.users,[t.payload.id]:t.payload}};case"make user online":return{...e,users:{...e.users,[t.payload]:{...e.users[t.payload],online:!0}}};case"append users":return{...e,users:{...e.users,...t.payload}};case"set messages":return{...e,rooms:{...e.rooms,[t.payload.id]:{...e.rooms[t.payload.id],messages:t.payload.messages,offset:t.payload.messages.length}}};case"prepend messages":{const s=[...t.payload.messages,...e.rooms[t.payload.id].messages];return{...e,rooms:{...e.rooms,[t.payload.id]:{...e.rooms[t.payload.id],messages:s,offset:s.length}}}}case"append message":return void 0===e.rooms[t.payload.id]?e:{...e,rooms:{...e.rooms,[t.payload.id]:{...e.rooms[t.payload.id],lastMessage:t.payload.message,messages:e.rooms[t.payload.id].messages?[...e.rooms[t.payload.id].messages,t.payload.message]:void 0}}};case"set last message":return{...e,rooms:{...e.rooms,[t.payload.id]:{...e.rooms[t.payload.id],lastMessage:t.payload.lastMessage}}};case"set current room":return{...e,currentRoom:t.payload};case"add room":return{...e,rooms:{...e.rooms,[t.payload.id]:t.payload}};case"set rooms":{const s=t.payload,a={...e.rooms};return s.forEach((e=>{a[e.id]={...e,messages:a[e.id]&&a[e.id].messages}})),{...e,rooms:a}}default:return e}},d={currentRoom:"main",rooms:{},users:{}},m=Object(a.createContext)(),u=()=>{const[e,t]=Object(a.useContext)(m);return[e,t]};var j=()=>Object(a.useReducer)(i,d),g=s(9),h=s.n(g),b=s(2),p=s.n(b);p.a.defaults.withCredentials=!0;p.a.interceptors.request.use((e=>{const t=localStorage.getItem("access_token");return t&&(e.headers.Authorization="Bearer "+t),e}),(e=>{console.log(e),Promise.reject(e)}));const x=e=>"".concat("http://34.41.1.159:8080/v1/chat").concat(e),O=e=>"".concat("http://34.41.1.159:8080/v1/auth").concat(e),f=()=>{const e=localStorage.getItem("username")?localStorage.getItem("username"):null;return console.log(e),p.a.get(x("/me?username="+e)).then((e=>e.data)).catch((e=>null))},v=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15;return p.a.get(x("/room/".concat(e,"/messages")),{params:{offset:t,size:s}}).then((e=>e.data.reverse()))},y=async(e,t,s,a)=>p.a.post(x("/room/create/"),{host:e,guest:t,host_name:s,guest_name:a}).then((e=>e.data)),N=async e=>p.a.get(x("/rooms/".concat(e))).then((e=>e.data)),w=(e,t)=>{for(let s of e)if("string"!==typeof s&&(s=s[0]),s!==t)return s;return e[0]},S=(s(78),async(e,t,s)=>{const a={};s.forEach((e=>{a[e.from]=1}));const o=Object.keys(a).filter((t=>void 0===e[t]));if(0!==o.length){const e=await(e=>p.a.get(x("/users"),{params:{ids:e}}).then((e=>e.data)))(o);t({type:"append users",payload:e})}});var k=()=>Object(c.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 1651 1651",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Object(c.jsx)("rect",{width:"1651",height:"1651",rx:"14",fill:"white"}),Object(c.jsx)("path",{d:"M495.286 1098.96L497.967 1070.86L478.04 1050.88C408.572 981.233 368 891.771 368 795.344C368 585.371 565.306 402 826 402C1086.69 402 1284 585.371 1284 795.344C1284 1005.32 1086.69 1188.69 826 1188.69V1248.69L825.913 1188.69C779.837 1188.75 733.952 1182.77 689.432 1170.9L667.26 1164.98L646.8 1175.37C620.731 1188.61 562.74 1213.98 467.32 1235.35C480.554 1191.83 490.95 1144.39 495.286 1098.96Z",stroke:"url(#paint0_linear)",strokeWidth:"120"}),Object(c.jsx)("defs",{children:Object(c.jsxs)("linearGradient",{id:"paint0_linear",x1:"662.312",y1:"397.956",x2:"416.164",y2:"1678.7",gradientUnits:"userSpaceOnUse",children:[Object(c.jsx)("stop",{stopColor:"#7514FB"}),Object(c.jsx)("stop",{offset:"0.624243",stopColor:"#F26D41"}),Object(c.jsx)("stop",{offset:"1",stopColor:"#F43B4B"})]})})]});var C=e=>{let{name:t,id:s}=e;const o=Object(a.useMemo)((()=>localStorage.getItem("profile_photo")),[s]);return Object(c.jsx)(c.Fragment,{children:"General"!==t?Object(c.jsx)("img",{src:o,alt:t,style:{width:32,height:32,objectFit:"cover"},className:"rounded-circle avatar-xs"}):Object(c.jsx)("div",{className:"overflow-hidden rounded-circle",children:Object(c.jsx)(k,{})})})};var I=e=>{let{online:t,hide:s=!1,width:a=8,height:o=8}=e;return Object(c.jsx)("div",{className:t?"rounded-circle bg-success":"rounded-circle bg-gray",style:{width:a,height:o,opacity:s?0:1}})};const L=e=>{const{id:t,name:s}=e,[o]=u(),[n,r,c]=Object(a.useMemo)((()=>{try{let e=Math.abs(parseInt(t.split(":").reverse().pop()));const a=e>0,n=Object.entries(o.users).filter((e=>{let[,t]=e;return t.username===s})).map((e=>{let[,t]=e;return t}));let r=!1;return n.length>0&&(r=n[0].online,e=+n[0].id),[a,r,e]}catch(e){return[!1,!1,"0"]}}),[t,s,o.users]),l=M(e);return{isUser:n,online:r,userId:c,name:e.name,lastMessage:l}},M=e=>{const[,t]=u(),{lastMessage:s}=e;return Object(a.useEffect)((()=>{void 0===s&&(void 0===e.messages?v(e.id,0,1).then((s=>{let a=null;0!==s.length&&(a=s.pop()),t({type:"set last message",payload:{id:e.id,lastMessage:a}})})):0===e.messages.length?t({type:"set last message",payload:{id:e.id,lastMessage:null}}):t({type:"set last message",payload:{id:e.id,lastMessage:e.messages[e.messages.length-1]}}))}),[s,t,e]),s};var _=e=>{let{room:t,active:s=!1,onClick:a}=e;const{online:o,name:n,lastMessage:r,userId:l}=L(t);return Object(c.jsxs)("div",{onClick:a,className:"chat-list-item d-flex align-items-start rounded ".concat(s?"bg-white":""),children:[Object(c.jsx)("div",{className:"align-self-center mr-3",children:Object(c.jsx)(I,{online:o,hide:"0"===t.id})}),Object(c.jsx)("div",{className:"align-self-center mr-3",children:Object(c.jsx)(C,{name:n,id:l})}),Object(c.jsxs)("div",{className:"media-body overflow-hidden",children:[Object(c.jsx)("h5",{className:"text-truncate font-size-14 mb-1",children:n}),r&&Object(c.jsxs)("p",{className:"text-truncate mb-0",children:[" ",r.message," "]})]}),r&&Object(c.jsx)("div",{className:"font-size-11",children:h.a.unix(r.date).format("LT")})]})},E=s(102);const R=e=>{let{onLogOut:t,col:s=5,noinfo:a=!1}=e;return Object(c.jsxs)("div",{onClick:t,style:{cursor:"pointer"},className:"col-".concat(s," text-danger ").concat(a?"":"text-right"),children:[Object(c.jsx)(E.a,{})," Log out"]})},z=e=>{let{user:t,col:s=7,noinfo:a=!1}=e;return Object(c.jsxs)("div",{className:"col-".concat(s," d-flex align-items-center ").concat(a?"justify-content-end":""),children:[Object(c.jsx)("div",{className:"align-self-center ".concat(a?"":"mr-3"),children:Object(c.jsx)(C,{name:t.username,id:t.id})}),!a&&Object(c.jsxs)("div",{className:"media-body",children:[Object(c.jsx)("h5",{className:"font-size-14 mt-0 mb-1",children:t.username}),Object(c.jsxs)("div",{className:"d-flex align-items-center",children:[Object(c.jsx)(I,{online:!0}),Object(c.jsx)("p",{className:"ml-2 text-muted mb-0",children:"Active"})]})]})]})};var B=e=>{let{user:t,onLogOut:s}=e;return Object(c.jsx)("div",{className:"row no-gutters align-items-center pl-4 pr-2 pb-3",style:{height:"inherit",flex:0,minHeight:50},children:Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)(z,{user:t,col:8}),Object(c.jsx)(R,{onLogOut:s,col:4})]})})};var F=e=>{let{rooms:t,dispatch:s,user:o,currentRoom:n,onLogOut:r}=e;const[l,i]=Object(a.useState)(""),[d,m]=Object(a.useState)([]),[u,j]=Object(a.useState)(t),g=Object(a.useMemo)((()=>{const e=Object.values(t),s=e.filter((e=>"0"===e.id));let a=e.filter((e=>"0"!==e.id));return console.log(a),a=a.sort(((e,t)=>+e.id.split(":").pop()-+t.id.split(":").pop())),[...s||[],...a]}),[t]);return Object(c.jsx)(c.Fragment,{children:Object(c.jsxs)("div",{className:"chat-list-container flex-column d-flex pr-4",children:[Object(c.jsx)("div",{className:"py-2 px-2"}),Object(c.jsx)("div",{className:"dropdownn",children:d.map(((e,t)=>Object(c.jsx)("button",{className:"dropdown-content btn btn-light",onClick:()=>(async e=>{await y(localStorage.getItem("userId"),e.split("-")[1],localStorage.getItem("username"),e.split("-")[0]);const t=await N(localStorage.getItem("userId"));console.log(t),j(t),i(""),m([])})(e.email+"-"+e.userId),children:e.email+"-"+e.userId},t)))}),Object(c.jsx)("div",{className:"messages-box flex flex-1",children:Object(c.jsx)("div",{className:"list-group rounded-0",children:g.map((e=>Object(c.jsx)(_,{onClick:()=>s({type:"set current room",payload:e.id}),active:n===e.id,room:e},e.id)))})}),Object(c.jsx)(B,{user:o,onLogOut:r})]})})};var T=e=>{let{message:t}=e;return Object(c.jsx)("p",{className:"mb-2 fs-6 fw-light fst-italic text-black-50 text-center",style:{opacity:.8,fontSize:14},children:t})};var U=()=>Object(c.jsx)("div",{className:"no-messages flex-column d-flex flex-row justify-content-center align-items-center text-muted text-center",children:Object(c.jsx)("div",{className:"spinner-border",role:"status",children:Object(c.jsx)("span",{className:"visually-hidden"})})}),W=s(103);var D=()=>Object(c.jsxs)("div",{className:"no-messages flex-column d-flex flex-row justify-content-center align-items-center text-muted text-center",children:[Object(c.jsx)(W.a,{size:96}),Object(c.jsx)("p",{children:"No messages"})]});var H=()=>Object(c.jsxs)("svg",{width:12,height:12,className:"prefix__MuiSvgIcon-root prefix__jss80 prefix__MuiSvgIcon-fontSizeLarge",viewBox:"0 0 24 24","aria-hidden":"true",children:[Object(c.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),Object(c.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"})]});var P=e=>{let{username:t="user",message:s="Lorem ipsum dolor...",date:a}=e;const o=s.startsWith("http://")||s.startsWith("https://");return console.log(o),Object(c.jsxs)("div",{className:"d-flex",children:[Object(c.jsx)("div",{style:{flex:1}}),Object(c.jsx)("div",{style:{width:"50%"},className:"text-right mb-4",children:Object(c.jsx)("div",{className:"conversation-list d-inline-block bg-light px-3 py-2",style:{borderRadius:12},children:Object(c.jsxs)("div",{className:"ctext-wrap",children:[Object(c.jsx)("div",{className:"conversation-name text-left text-primary mb-1",style:{fontWeight:600},children:t}),o?Object(c.jsx)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"text-left",children:s}):Object(c.jsx)("p",{className:"text-left",children:s}),Object(c.jsxs)("p",{className:"chat-time mb-0",children:[Object(c.jsx)(H,{})," ",h.a.unix(a).format("LT")," "]})]})})})]})};var V=e=>{let{user:t,message:s="Lorem ipsum dolor...",date:a,onUserClicked:o}=e;const n=s.startsWith("http://")||s.startsWith("https://");return Object(c.jsxs)("div",{className:"d-flex",children:[Object(c.jsx)("div",{style:{width:"50%"},className:"text-left mb-4",children:Object(c.jsx)("div",{className:"conversation-list d-inline-block px-3 py-2",style:{borderRadius:12,backgroundColor:"rgba(85, 110, 230, 0.1)"},children:Object(c.jsxs)("div",{className:"ctext-wrap",children:[t&&Object(c.jsxs)("div",{className:"conversation-name text-primary d-flex align-items-center mb-1",children:[Object(c.jsx)("div",{className:"mr-2",style:{fontWeight:600,cursor:"pointer"},onClick:o,children:t.username}),Object(c.jsx)(I,{width:7,height:7,online:t.online})]}),n?Object(c.jsx)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"text-left",children:s}):Object(c.jsx)("p",{className:"text-left",children:s}),Object(c.jsxs)("p",{className:"chat-time mb-0",children:[Object(c.jsx)(H,{})," ",h.a.unix(a).format("LT")," "]})]})})}),Object(c.jsx)("div",{style:{flex:1}})]})};var q=e=>{let{messageListElement:t,messages:s,room:a,onLoadMoreMessages:o,user:n,onUserClicked:r,users:l}=e;return Object(c.jsxs)("div",{ref:t,className:"chat-box-wrapper position-relative d-flex",children:[void 0===s?Object(c.jsx)(U,{}):0===s.length?Object(c.jsx)(D,{}):Object(c.jsx)(c.Fragment,{}),Object(c.jsx)("div",{className:"px-4 pt-5 chat-box position-absolute",children:s&&0!==s.length&&Object(c.jsxs)(c.Fragment,{children:[a.offset&&a.offset>=15?Object(c.jsxs)("div",{className:"d-flex flex-row align-items-center mb-4",children:[Object(c.jsx)("div",{style:{height:1,backgroundColor:"#eee",flex:1}}),Object(c.jsx)("div",{className:"mx-3",children:Object(c.jsx)("button",{"aria-haspopup":"true","aria-expanded":"true",type:"button",onClick:o,className:"btn rounded-button btn-secondary nav-btn",id:"__BVID__168__BV_toggle_",children:"Load more"})}),Object(c.jsx)("div",{style:{height:1,backgroundColor:"#eee",flex:1}})]}):Object(c.jsx)(c.Fragment,{}),s.map(((e,t)=>{const s=e.message+e.date+e.from+t;return"info"===e.from?Object(c.jsx)(T,{message:e.message},s):+e.from!==+n.id?Object(c.jsx)(V,{onUserClicked:()=>r(e.from),message:e.message,date:e.date,user:l[e.from]},s):Object(c.jsx)(P,{username:l[e.from]?l[e.from].username:"",message:e.message,date:e.date},s)}))]})})]})};var A=e=>{let{message:t,setMessage:s,onSubmit:o}=e;const n=Object(a.useRef)(null),r=Object(a.useRef)(null);return Object(c.jsx)("div",{className:"p-3 chat-input-section",children:Object(c.jsx)("form",{className:"row",onSubmit:o,ref:r,children:Object(c.jsx)("div",{className:"col",children:Object(c.jsxs)("div",{className:"position-relative upload-icon",children:[Object(c.jsx)("button",{className:"btn btn-primary upload-icon",type:"button",onClick:()=>{n.current.click()},children:Object(c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",fill:"currentColor",className:"bi bi-cloud-arrow-up",viewBox:"0 0 16 16",children:[Object(c.jsx)("path",{fillRule:"evenodd",d:"M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708z"}),Object(c.jsx)("path",{d:"M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"})]})}),Object(c.jsx)("input",{value:t,onChange:e=>s(e.target.value),type:"text",placeholder:"Enter Message...",className:"form-control chat-input"}),Object(c.jsx)("input",{type:"file",ref:n,style:{display:"none"},onChange:async e=>{if(e.target.files&&e.target.files.length>0){const a=e.target.files[0];try{const e=await(e=>{console.log(e);const t=new FormData;return t.append("files",e),p.a.post((s="/upload","".concat("http://34.41.1.159:8080/v1").concat(s)),t,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>e)).catch((e=>{throw new Error(e.response&&e.response.data&&e.response.data.message)}));var s})(a);s(e.data.response),o({message:e.data.response})}catch(t){console.error("Error uploading file:",t)}}},accept:"image/png, image/jpeg, application/pdf, text/plain"}),Object(c.jsx)("div",{className:"col-auto",children:Object(c.jsxs)("button",{type:"submit",className:"btn btn-primary btn-rounded chat-send w-md",children:[Object(c.jsx)("span",{className:"d-none d-sm-inline-block mr-2",children:"Send"}),Object(c.jsx)("svg",{width:13,height:13,viewBox:"0 0 24 24",tabIndex:-1,children:Object(c.jsx)("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z",fill:"white"})})]})})]})})})})};var G=e=>{const[t,s]=u(),o=Object(a.useRef)(null),n=t.rooms[t.currentRoom],r=null===n||void 0===n?void 0:n.id,c=null===n||void 0===n?void 0:n.messages,[l,i]=Object(a.useState)(""),d=Object(a.useCallback)((()=>{setTimeout((()=>{o.current&&(o.current.scrollTop=0)}),0)}),[]),m=Object(a.useCallback)((()=>{o.current&&o.current.scrollTo({top:o.current.scrollHeight})}),[]);Object(a.useEffect)((()=>{m()}),[c,m]);const j=Object(a.useCallback)((function(){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];v(r,arguments.length>0&&void 0!==arguments[0]?arguments[0]:0).then((async a=>{await S(t.users,s,a),s({type:e?"prepend messages":"set messages",payload:{id:r,messages:a}}),e?setTimeout((()=>{d()}),10):m()}))}),[s,r,m,d,t.users]);Object(a.useEffect)((()=>{void 0!==r&&void 0===c&&j()}),[c,s,r,t.users,t,m,j]),Object(a.useEffect)((()=>{o.current&&m()}),[m,r]);return{onLoadMoreMessages:Object(a.useCallback)((()=>{j(n.offset,!0)}),[j,n]),onUserClicked:async a=>{const o=t.users[a];let n=o.room;if(void 0===n){console.log(e.id,a,localStorage.getItem("username"),t.users[a].username);const r=await y(e.id,a,localStorage.getItem("username"),t.users[a].username);n=r.id,s({type:"set user",payload:{...o,room:n}}),s({type:"add room",payload:{id:n,name:w(r.names,e.username)}})}s({type:"set current room",payload:n})},message:l,setMessage:i,dispatch:s,room:n,rooms:t.rooms,currentRoom:t.currentRoom,messageListElement:o,roomId:r,users:t.users,messages:c}};function J(e){let{onLogOut:t,user:s,onMessageSend:a}=e;const{onLoadMoreMessages:o,onUserClicked:n,message:r,setMessage:l,rooms:i,room:d,currentRoom:m,dispatch:u,messageListElement:j,roomId:g,messages:h,users:b}=G(s);return Object(c.jsx)("div",{className:"container py-5 px-4",children:Object(c.jsxs)("div",{className:"chat-body row overflow-hidden shadow bg-light rounded",children:[Object(c.jsx)("div",{className:"col-4 px-0",children:Object(c.jsx)(F,{user:s,onLogOut:t,rooms:i,currentRoom:m,dispatch:u})}),Object(c.jsxs)("div",{className:"col-8 px-0 flex-column bg-white rounded-lg",children:[Object(c.jsx)("div",{className:"px-4 py-4",style:{borderBottom:"1px solid #eee"},children:Object(c.jsx)("h2",{className:"font-size-15 mb-0",children:d?d.name:"Room"})}),Object(c.jsx)(q,{messageListElement:j,messages:h,room:d,onLoadMoreMessages:o,user:s,onUserClicked:n,users:b}),Object(c.jsx)(A,{message:r,setMessage:l,onSubmit:e=>{e.message?(a(e.message.trim(),g),l("")):(e.preventDefault(),a(r.trim(),g),l("")),j.current.scrollTop=j.current.scrollHeight}})]})]})})}function Z(){return Object(c.jsx)("div",{className:"centered-box",children:Object(c.jsx)("div",{className:"spinner-border",role:"status",children:Object(c.jsx)("span",{className:"visually-hidden"})})})}var K=()=>Object(c.jsx)("nav",{className:"navbar navbar-expand-lg navbar-light bg-white",children:Object(c.jsx)("span",{className:"navbar-brand",children:"Chat demo"})}),Q=s(43),X=s.n(Q);const Y=(e,t,s)=>{t({type:"set user",payload:e}),void 0!==s&&t({type:"append message",payload:{id:"0",message:{date:1e4*Math.random(),from:"info",message:s}}})},$=(e,t,s)=>s({type:"add room",payload:{id:e.id,name:w(e.names,t)}}),ee=(e,t)=>{t({type:"make user online",payload:e.from}),t({type:"append message",payload:{id:void 0===e.roomId?"0":e.roomId,message:e}})},te=(e,t)=>{const[s,o]=Object(a.useState)(!1),n=Object(a.useRef)(null),r=Object(a.useRef)(null),c=n.current;return Object(a.useEffect)((()=>{null===e?(null!==c&&c.disconnect(),o(!1),null!==r.current&&(r.current.close(),r.current=null)):(null===r.current&&(r.current=(()=>{return new EventSource((e="/stream","".concat("http://130.211.193.230:5000").concat(e)));var e})(),r.current.onmessage=function(s){const{type:a,data:o}=JSON.parse(s.data);switch(a){case"user.connected":Y(o,t,"".concat(o.username," connected"));break;case"user.disconnected":Y(o,t,"".concat(o.username," left"));break;case"show.room":$(o,e.username,t);break;case"message":ee(o,t)}}),null!==c?c.connect():n.current=X()(),o(!0))}),[e,c,t]),Object(a.useEffect)((()=>{s&&e?(c.on("user.connected",(e=>Y(e,t,"".concat(e.username," connected")))),c.on("user.disconnected",(e=>Y(e,t,"".concat(e.username," left")))),c.on("show.room",(s=>{$(s,e.username,t)})),c.on("message",(e=>{ee(e,t)}))):c&&(c.off("user.connected"),c.off("user.disconnected"),c.off("user.room"),c.off("message"))}),[s,e,t,c]),[c,s]},se=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>{},t=arguments.length>1?arguments[1]:void 0;const[s,o]=Object(a.useState)(!0),[n,r]=Object(a.useState)(null);return Object(a.useEffect)((()=>{s&&f().then((t=>{r(t),o(!1),e(t)}))}),[e,s]),{user:n,onLogIn:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};a(null),n(!0),((e,t)=>p.a.post(O("/login"),{username:e,password:t}).then((e=>{localStorage.setItem("access_token",e.data.id_token),localStorage.setItem("username",e.data.email),localStorage.setItem("userId",e.data.userId),localStorage.setItem("profile_photo",e.data.photo)})).catch((e=>{throw new Error(e.response&&e.response.data&&e.response.data.message)})))(t,s).then((t=>{f().then((t=>{r(t),o(!1),e(t)}))})).catch((e=>a(e.message))).finally((()=>n(!1)))},onSignup:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};a(null),n(!0),((e,t)=>p.a.post(O("/signup"),{username:e,password:t}).then((e=>{localStorage.setItem("access_token",e.data.id_token),localStorage.setItem("username",e.data.email),localStorage.setItem("userId",e.data.userId),localStorage.setItem("profile_photo",e.data.photo)})).catch((e=>{throw e.response})))(t,s).then((t=>{f().then((t=>{r(t),o(!1),e(t)}))})).catch((e=>a(e.data))).finally((()=>n(!1)))},onLogOut:async()=>{p.a.post(O("/logout")).then((e=>{localStorage.removeItem("access_token"),localStorage.removeItem("username"),localStorage.removeItem("userId"),localStorage.removeItem("profile_photo")})).catch((e=>{throw new Error(e.response&&e.response.data&&e.response.data.message)})).then((()=>{r(null),t({type:"clear"}),o(!0)}))},loading:s}},ae=()=>{const[e,t]=j(),s=Object(a.useCallback)((s=>{null!==s&&(e.users[s.id]||t({type:"set user",payload:{...s,online:!0}}))}),[t,e.users]),{user:o,onLogIn:n,onSignup:r,onLogOut:c,loading:l}=se(s,t),[i,d]=te(o,t);Object(a.useEffect)((()=>{if(null!==o)if(d){const s=[];Object.keys(e.rooms).forEach((t=>{const a=e.rooms[t];a.connected||(s.push({...a,connected:!0}),i.emit("room.join",a.id))})),0!==s.length&&t({type:"set rooms",payload:s})}else{const s=[];Object.keys(e.rooms).forEach((t=>{const a=e.rooms[t];a.connected&&s.push({...a,connected:!1})})),0!==s.length&&t({type:"set rooms",payload:s})}}),[o,d,t,i,e.rooms,e.users]),Object(a.useEffect)((()=>{0===Object.values(e.rooms).length&&null!==o&&(p.a.get(x("/users/online")).then((e=>e.data)).then((e=>{t({type:"append users",payload:e})})),N(o.id).then((e=>{const s=[];e.forEach((e=>{let{id:t,names:a}=e;s.push({id:t,name:w(a,o.username)})})),t({type:"set rooms",payload:s}),t({type:"set current room",payload:"0"})})))}),[t,e.rooms,o]);const m=Object(a.useCallback)(((e,t)=>{"string"===typeof e&&0!==e.trim().length&&(i||console.error("Couldn't send message"),i.emit("message",{roomId:t,message:e,from:o.id,date:h()(new Date).unix()}))}),[o,i]);return{loading:l,user:o,state:e,dispatch:t,onLogIn:n,onSignup:r,onMessageSend:m,onLogOut:c}};var oe=()=>{const{loading:e,user:t,state:s,dispatch:a,onLogIn:o,onSignup:n,onMessageSend:r,onLogOut:i}=ae();if(e)return Object(c.jsx)(Z,{});console.log(t);const d=!localStorage.getItem("userId");return console.log(d),Object(c.jsx)(m.Provider,{value:[s,a],children:Object(c.jsxs)("div",{className:"full-height ".concat(d?"bg-light":""),style:{backgroundColor:d?void 0:"#495057"},children:[Object(c.jsx)(K,{}),d?Object(c.jsx)(l,{onLogIn:o,onSignup:n}):Object(c.jsx)(J,{user:t,onMessageSend:r,onLogOut:i})]})})};n.a.render(Object(c.jsx)(oe,{}),document.getElementById("root"))}},[[99,1,2]]]);
//# sourceMappingURL=main.d76f5290.chunk.js.map