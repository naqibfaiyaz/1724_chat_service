(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{47:function(e,s,t){},48:function(e,s,t){},49:function(e,s,t){},55:function(e,s,t){},58:function(e,s,t){},99:function(e,s,t){"use strict";t.r(s);t(46),t(47),t(48),t(49);var a=t(1),c=t(10),n=t.n(c),r=t(104),o=t(0);var l=e=>{let{width:s=64,height:t=64}=e;return Object(o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 32 32",height:t,width:s,children:[Object(o.jsx)("script",{}),Object(o.jsxs)("defs",{children:[Object(o.jsx)("path",{id:"prefix__a",d:"M45.536 38.764c-2.013 1.05-12.44 5.337-14.66 6.494s-3.453 1.146-5.207.308-12.85-5.32-14.85-6.276c-1-.478-1.524-.88-1.524-1.26v-3.813s14.447-3.145 16.78-3.982 3.14-.867 5.126-.14 13.853 2.868 15.814 3.587v3.76c0 .377-.452.8-1.477 1.324z"}),Object(o.jsx)("path",{id:"prefix__b",d:"M45.536 28.733c-2.013 1.05-12.44 5.337-14.66 6.494s-3.453 1.146-5.207.308-12.85-5.32-14.85-6.276-2.04-1.613-.077-2.382l15.332-5.935c2.332-.837 3.14-.867 5.126-.14s12.35 4.853 14.312 5.57 2.037 1.31.024 2.36z"})]}),Object(o.jsxs)("g",{transform:"matrix(.84833 0 0 .84833 -7.884 -9.45)",children:[Object(o.jsx)("use",{fill:"#a41e11",xlinkHref:"#prefix__a"}),Object(o.jsx)("path",{d:"M45.536 34.95c-2.013 1.05-12.44 5.337-14.66 6.494s-3.453 1.146-5.207.308-12.85-5.32-14.85-6.276-2.04-1.613-.077-2.382l15.332-5.936c2.332-.836 3.14-.867 5.126-.14S43.55 31.87 45.51 32.6s2.037 1.31.024 2.36z",fill:"#d82c20"}),Object(o.jsx)("use",{fill:"#a41e11",xlinkHref:"#prefix__a",y:-6.218}),Object(o.jsx)("use",{fill:"#d82c20",xlinkHref:"#prefix__b"}),Object(o.jsx)("path",{d:"M45.536 26.098c-2.013 1.05-12.44 5.337-14.66 6.495s-3.453 1.146-5.207.308-12.85-5.32-14.85-6.276c-1-.478-1.524-.88-1.524-1.26V21.55s14.447-3.145 16.78-3.982 3.14-.867 5.126-.14 13.853 2.868 15.814 3.587v3.76c0 .377-.452.8-1.477 1.324z",fill:"#a41e11"}),Object(o.jsx)("use",{fill:"#d82c20",xlinkHref:"#prefix__b",y:-6.449}),Object(o.jsxs)("g",{fill:"#fff",children:[Object(o.jsx)("path",{d:"M29.096 20.712l-1.182-1.965-3.774-.34 2.816-1.016-.845-1.56 2.636 1.03 2.486-.814-.672 1.612 2.534.95-3.268.34zM22.8 24.624l8.74-1.342-2.64 3.872z"}),Object(o.jsx)("ellipse",{cx:20.444,cy:21.402,rx:4.672,ry:1.811})]}),Object(o.jsx)("path",{d:"M42.132 21.138l-5.17 2.042-.004-4.087z",fill:"#7a0c00"}),Object(o.jsx)("path",{d:"M36.963 23.18l-.56.22-5.166-2.042 5.723-2.264z",fill:"#ad2115"})]})]})};t(55);const i=["Pablo","Joe","Mary","Alex"];function d(e){let{onLogIn:s}=e;const[t,c]=Object(a.useState)((()=>i[Math.floor(Math.random()*i.length)])),[n,d]=Object(a.useState)("password123"),[j,u]=Object(a.useState)(null);return Object(o.jsx)(o.Fragment,{children:Object(o.jsx)("div",{className:"login-form text-center login-page",children:Object(o.jsxs)("div",{className:"rounded",style:{boxShadow:"0 0.75rem 1.5rem rgba(18,38,63,.03)"},children:[Object(o.jsxs)("div",{className:"position-relative",children:[Object(o.jsxs)("div",{className:"row no-gutters align-items-center",style:{maxWidth:400,backgroundColor:"rgba(85, 110, 230, 0.25)",paddingLeft:20,paddingRight:20,borderTopLeftRadius:4,borderTopRightRadius:4},children:[Object(o.jsxs)("div",{className:"col text-primary text-left",children:[Object(o.jsx)("h3",{className:"font-size-15",children:"Welcome Back !"}),Object(o.jsx)("p",{children:"Sign in to continue"})]}),Object(o.jsx)("div",{className:"col align-self-end",children:Object(o.jsx)("img",{alt:"welcome back",style:{maxWidth:"100%"},src:"".concat("","/welcome-back.png")})})]}),Object(o.jsx)("div",{className:"position-absolute",style:{bottom:-36,left:20},children:Object(o.jsx)("div",{style:{backgroundColor:"rgb(239, 242, 247)",width:72,height:72},className:"rounded-circle d-flex align-items-center justify-content-center",children:Object(o.jsx)(l,{width:34,height:34})})})]}),Object(o.jsxs)("form",{className:"bg-white text-left px-4",style:{paddingTop:58,borderBottomLeftRadius:4,borderBottomRightRadius:4},onSubmit:async e=>{e.preventDefault(),s(t,n,u)},children:[Object(o.jsx)("label",{className:"font-size-12",children:"Name"}),Object(o.jsx)("div",{className:"username-select mb-3",children:Object(o.jsx)(m,{username:t,setUsername:c,names:i})}),Object(o.jsx)("label",{htmlFor:"inputPassword",className:"font-size-12",children:"Password"}),Object(o.jsx)("input",{value:n,onChange:e=>d(e.target.value),type:"password",id:"inputPassword",className:"form-control",placeholder:"Password",required:!0}),Object(o.jsx)("div",{style:{height:30}}),Object(o.jsx)("button",{className:"btn btn-lg btn-primary btn-block",type:"submit",children:"Sign in"}),Object(o.jsx)("div",{className:"login-error-anchor",children:Object(o.jsx)("div",{className:"toast-box",children:Object(o.jsxs)(r.a,{style:{minWidth:277},onClose:()=>u(null),show:null!==j,delay:3e3,autohide:!0,children:[Object(o.jsxs)(r.a.Header,{children:[Object(o.jsx)("img",{src:"holder.js/20x20?text=%20",className:"rounded mr-2",alt:""}),Object(o.jsx)("strong",{className:"mr-auto",children:"Error"})]}),Object(o.jsx)(r.a.Body,{children:j})]})})}),Object(o.jsx)("div",{style:{height:30}})]})]})})})}const m=e=>{var s;let{username:t,setUsername:c,names:n=[""]}=e;const[r,l]=Object(a.useState)(!1),[i,d]=Object(a.useState)(0),m=Object(a.useRef)(),j=null===(s=m.current)||void 0===s?void 0:s.getBoundingClientRect().width;return Object(a.useEffect)((()=>{d(j)}),[j]),Object(a.useEffect)((()=>{if(r){const e=()=>l(!1);return document.addEventListener("click",e),()=>document.removeEventListener("click",e)}}),[r]),Object(a.useEffect)((()=>{var e;r&&(null===(e=m.current)||void 0===e||e.focus())}),[r]),Object(o.jsxs)("div",{tabIndex:0,ref:m,className:"username-select-dropdown ".concat(r?"open":""),onClick:()=>l((e=>!e)),children:[Object(o.jsxs)("div",{className:"username-select-row",children:[Object(o.jsx)("div",{children:t}),Object(o.jsx)("div",{children:Object(o.jsx)("svg",{width:24,height:24,children:Object(o.jsx)("path",{d:"M7 10l5 5 5-5z",fill:"#333"})})})]}),Object(o.jsx)("div",{style:{width:i},className:"username-select-block ".concat(r?"open":""),children:n.map((e=>Object(o.jsx)("div",{className:"username-select-block-item",onClick:()=>c(e),children:e},e)))})]})};t(58);const j=(e,s)=>{switch(s.type){case"clear":return{currentRoom:"0",rooms:{},users:{}};case"set user":return{...e,users:{...e.users,[s.payload.id]:s.payload}};case"make user online":return{...e,users:{...e.users,[s.payload]:{...e.users[s.payload],online:!0}}};case"append users":return{...e,users:{...e.users,...s.payload}};case"set messages":return{...e,rooms:{...e.rooms,[s.payload.id]:{...e.rooms[s.payload.id],messages:s.payload.messages,offset:s.payload.messages.length}}};case"prepend messages":{const t=[...s.payload.messages,...e.rooms[s.payload.id].messages];return{...e,rooms:{...e.rooms,[s.payload.id]:{...e.rooms[s.payload.id],messages:t,offset:t.length}}}}case"append message":return void 0===e.rooms[s.payload.id]?e:{...e,rooms:{...e.rooms,[s.payload.id]:{...e.rooms[s.payload.id],lastMessage:s.payload.message,messages:e.rooms[s.payload.id].messages?[...e.rooms[s.payload.id].messages,s.payload.message]:void 0}}};case"set last message":return{...e,rooms:{...e.rooms,[s.payload.id]:{...e.rooms[s.payload.id],lastMessage:s.payload.lastMessage}}};case"set current room":return{...e,currentRoom:s.payload};case"add room":return{...e,rooms:{...e.rooms,[s.payload.id]:s.payload}};case"set rooms":{const t=s.payload,a={...e.rooms};return t.forEach((e=>{a[e.id]={...e,messages:a[e.id]&&a[e.id].messages}})),{...e,rooms:a}}default:return e}},u={currentRoom:"main",rooms:{},users:{}},b=Object(a.createContext)(),h=()=>{const[e,s]=Object(a.useContext)(b);return[e,s]};var x=()=>Object(a.useReducer)(j,u),g=t(9),p=t.n(g),O=t(5),f=t.n(O);f.a.defaults.withCredentials=!0;const v=e=>"".concat("localhost:5000").concat(e),y=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:15;return f.a.get(v("/room/".concat(e,"/messages")),{params:{offset:s,size:t}}).then((e=>e.data.reverse()))},N=(e,s)=>{for(let t of e)if("string"!==typeof t&&(t=t[0]),t!==s)return t;return e[0]},w=(t(78),async(e,s,t)=>{const a={};t.forEach((e=>{a[e.from]=1}));const c=Object.keys(a).filter((s=>void 0===e[s]));if(0!==c.length){const e=await(e=>f.a.get(v("/users"),{params:{ids:e}}).then((e=>e.data)))(c);s({type:"append users",payload:e})}});var k=()=>Object(o.jsxs)("svg",{width:"32",height:"32",viewBox:"0 0 1651 1651",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[Object(o.jsx)("rect",{width:"1651",height:"1651",rx:"14",fill:"white"}),Object(o.jsx)("path",{d:"M495.286 1098.96L497.967 1070.86L478.04 1050.88C408.572 981.233 368 891.771 368 795.344C368 585.371 565.306 402 826 402C1086.69 402 1284 585.371 1284 795.344C1284 1005.32 1086.69 1188.69 826 1188.69V1248.69L825.913 1188.69C779.837 1188.75 733.952 1182.77 689.432 1170.9L667.26 1164.98L646.8 1175.37C620.731 1188.61 562.74 1213.98 467.32 1235.35C480.554 1191.83 490.95 1144.39 495.286 1098.96Z",stroke:"url(#paint0_linear)",strokeWidth:"120"}),Object(o.jsx)("defs",{children:Object(o.jsxs)("linearGradient",{id:"paint0_linear",x1:"662.312",y1:"397.956",x2:"416.164",y2:"1678.7",gradientUnits:"userSpaceOnUse",children:[Object(o.jsx)("stop",{stopColor:"#7514FB"}),Object(o.jsx)("stop",{offset:"0.624243",stopColor:"#F26D41"}),Object(o.jsx)("stop",{offset:"1",stopColor:"#F43B4B"})]})})]});var M=e=>{let{name:s,id:t}=e;const c=Object(a.useMemo)((()=>{const e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1";const s=+e.split(":").pop();let t=+e.split(":").reverse().pop();t<0&&(t+=3555);const a=(654*s+531*t)%13;return"".concat("","/avatars/").concat(a,".jpg")}(""+t);return"Mary"===s?"".concat("","/avatars/0.jpg"):"Pablo"===s?"".concat("","/avatars/2.jpg"):"Joe"===s?"".concat("","/avatars/9.jpg"):"Alex"===s?"".concat("","/avatars/8.jpg"):e}),[t,s]);return Object(o.jsx)(o.Fragment,{children:"General"!==s?Object(o.jsx)("img",{src:c,alt:s,style:{width:32,height:32,objectFit:"cover"},className:"rounded-circle avatar-xs"}):Object(o.jsx)("div",{className:"overflow-hidden rounded-circle",children:Object(o.jsx)(k,{})})})};var C=e=>{let{online:s,hide:t=!1,width:a=8,height:c=8}=e;return Object(o.jsx)("div",{className:s?"rounded-circle bg-success":"rounded-circle bg-gray",style:{width:a,height:c,opacity:t?0:1}})};const L=e=>{const{id:s,name:t}=e,[c]=h(),[n,r,o]=Object(a.useMemo)((()=>{try{let e=Math.abs(parseInt(s.split(":").reverse().pop()));const a=e>0,n=Object.entries(c.users).filter((e=>{let[,s]=e;return s.username===t})).map((e=>{let[,s]=e;return s}));let r=!1;return n.length>0&&(r=n[0].online,e=+n[0].id),[a,r,e]}catch(e){return[!1,!1,"0"]}}),[s,t,c.users]),l=z(e);return{isUser:n,online:r,userId:o,name:e.name,lastMessage:l}},z=e=>{const[,s]=h(),{lastMessage:t}=e;return Object(a.useEffect)((()=>{void 0===t&&(void 0===e.messages?y(e.id,0,1).then((t=>{let a=null;0!==t.length&&(a=t.pop()),s({type:"set last message",payload:{id:e.id,lastMessage:a}})})):0===e.messages.length?s({type:"set last message",payload:{id:e.id,lastMessage:null}}):s({type:"set last message",payload:{id:e.id,lastMessage:e.messages[e.messages.length-1]}}))}),[t,s,e]),t};var S=e=>{let{room:s,active:t=!1,onClick:a}=e;const{online:c,name:n,lastMessage:r,userId:l}=L(s);return Object(o.jsxs)("div",{onClick:a,className:"chat-list-item d-flex align-items-start rounded ".concat(t?"bg-white":""),children:[Object(o.jsx)("div",{className:"align-self-center mr-3",children:Object(o.jsx)(C,{online:c,hide:"0"===s.id})}),Object(o.jsx)("div",{className:"align-self-center mr-3",children:Object(o.jsx)(M,{name:n,id:l})}),Object(o.jsxs)("div",{className:"media-body overflow-hidden",children:[Object(o.jsx)("h5",{className:"text-truncate font-size-14 mb-1",children:n}),r&&Object(o.jsxs)("p",{className:"text-truncate mb-0",children:[" ",r.message," "]})]}),r&&Object(o.jsx)("div",{className:"font-size-11",children:p.a.unix(r.date).format("LT")})]})},E=t(102);const _=e=>{let{onLogOut:s,col:t=5,noinfo:a=!1}=e;return Object(o.jsxs)("div",{onClick:s,style:{cursor:"pointer"},className:"col-".concat(t," text-danger ").concat(a?"":"text-right"),children:[Object(o.jsx)(E.a,{})," Log out"]})},R=e=>{let{user:s,col:t=7,noinfo:a=!1}=e;return Object(o.jsxs)("div",{className:"col-".concat(t," d-flex align-items-center ").concat(a?"justify-content-end":""),children:[Object(o.jsx)("div",{className:"align-self-center ".concat(a?"":"mr-3"),children:Object(o.jsx)(M,{name:s.username,id:s.id})}),!a&&Object(o.jsxs)("div",{className:"media-body",children:[Object(o.jsx)("h5",{className:"font-size-14 mt-0 mb-1",children:s.username}),Object(o.jsxs)("div",{className:"d-flex align-items-center",children:[Object(o.jsx)(C,{online:!0}),Object(o.jsx)("p",{className:"ml-2 text-muted mb-0",children:"Active"})]})]})]})};var I=e=>{let{user:s,onLogOut:t}=e;return Object(o.jsx)("div",{className:"row no-gutters align-items-center pl-4 pr-2 pb-3",style:{height:"inherit",flex:0,minHeight:50},children:Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(R,{user:s,col:8}),Object(o.jsx)(_,{onLogOut:t,col:4})]})})};var B=e=>{let{rooms:s,dispatch:t,user:c,currentRoom:n,onLogOut:r}=e;const l=Object(a.useMemo)((()=>{const e=Object.values(s),t=e.filter((e=>"0"===e.id));let a=e.filter((e=>"0"!==e.id));return a=a.sort(((e,s)=>+e.id.split(":").pop()-+s.id.split(":").pop())),[...t||[],...a]}),[s]);return Object(o.jsx)(o.Fragment,{children:Object(o.jsxs)("div",{className:"chat-list-container flex-column d-flex pr-4",children:[Object(o.jsx)("div",{className:"py-2",children:Object(o.jsx)("p",{className:"h5 mb-0 py-1 chats-title",children:"Chats"})}),Object(o.jsx)("div",{className:"messages-box flex flex-1",children:Object(o.jsx)("div",{className:"list-group rounded-0",children:l.map((e=>Object(o.jsx)(S,{onClick:()=>t({type:"set current room",payload:e.id}),active:n===e.id,room:e},e.id)))})}),Object(o.jsx)(I,{user:c,onLogOut:r})]})})};var F=e=>{let{message:s}=e;return Object(o.jsx)("p",{className:"mb-2 fs-6 fw-light fst-italic text-black-50 text-center",style:{opacity:.8,fontSize:14},children:s})};var T=()=>Object(o.jsx)("div",{className:"no-messages flex-column d-flex flex-row justify-content-center align-items-center text-muted text-center",children:Object(o.jsx)("div",{className:"spinner-border",role:"status",children:Object(o.jsx)("span",{className:"visually-hidden"})})}),U=t(103);var H=()=>Object(o.jsxs)("div",{className:"no-messages flex-column d-flex flex-row justify-content-center align-items-center text-muted text-center",children:[Object(o.jsx)(U.a,{size:96}),Object(o.jsx)("p",{children:"No messages"})]});var P=()=>Object(o.jsxs)("svg",{width:12,height:12,className:"prefix__MuiSvgIcon-root prefix__jss80 prefix__MuiSvgIcon-fontSizeLarge",viewBox:"0 0 24 24","aria-hidden":"true",children:[Object(o.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),Object(o.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"})]});var W=e=>{let{username:s="user",message:t="Lorem ipsum dolor...",date:a}=e;return Object(o.jsxs)("div",{className:"d-flex",children:[Object(o.jsx)("div",{style:{flex:1}}),Object(o.jsx)("div",{style:{width:"50%"},className:"text-right mb-4",children:Object(o.jsx)("div",{className:"conversation-list d-inline-block bg-light px-3 py-2",style:{borderRadius:12},children:Object(o.jsxs)("div",{className:"ctext-wrap",children:[Object(o.jsx)("div",{className:"conversation-name text-left text-primary mb-1",style:{fontWeight:600},children:s}),Object(o.jsx)("p",{className:"text-left",children:t}),Object(o.jsxs)("p",{className:"chat-time mb-0",children:[Object(o.jsx)(P,{})," ",p.a.unix(a).format("LT")," "]})]})})})]})};var D=e=>{let{user:s,message:t="Lorem ipsum dolor...",date:a,onUserClicked:c}=e;return Object(o.jsxs)("div",{className:"d-flex",children:[Object(o.jsx)("div",{style:{width:"50%"},className:"text-left mb-4",children:Object(o.jsx)("div",{className:"conversation-list d-inline-block px-3 py-2",style:{borderRadius:12,backgroundColor:"rgba(85, 110, 230, 0.1)"},children:Object(o.jsxs)("div",{className:"ctext-wrap",children:[s&&Object(o.jsxs)("div",{className:"conversation-name text-primary d-flex align-items-center mb-1",children:[Object(o.jsx)("div",{className:"mr-2",style:{fontWeight:600,cursor:"pointer"},onClick:c,children:s.username}),Object(o.jsx)(C,{width:7,height:7,online:s.online})]}),Object(o.jsx)("p",{className:"text-left",children:t}),Object(o.jsxs)("p",{className:"chat-time mb-0",children:[Object(o.jsx)(P,{})," ",p.a.unix(a).format("LT")," "]})]})})}),Object(o.jsx)("div",{style:{flex:1}})]})};var J=e=>{let{messageListElement:s,messages:t,room:a,onLoadMoreMessages:c,user:n,onUserClicked:r,users:l}=e;return Object(o.jsxs)("div",{ref:s,className:"chat-box-wrapper position-relative d-flex",children:[void 0===t?Object(o.jsx)(T,{}):0===t.length?Object(o.jsx)(H,{}):Object(o.jsx)(o.Fragment,{}),Object(o.jsx)("div",{className:"px-4 pt-5 chat-box position-absolute",children:t&&0!==t.length&&Object(o.jsxs)(o.Fragment,{children:[a.offset&&a.offset>=15?Object(o.jsxs)("div",{className:"d-flex flex-row align-items-center mb-4",children:[Object(o.jsx)("div",{style:{height:1,backgroundColor:"#eee",flex:1}}),Object(o.jsx)("div",{className:"mx-3",children:Object(o.jsx)("button",{"aria-haspopup":"true","aria-expanded":"true",type:"button",onClick:c,className:"btn rounded-button btn-secondary nav-btn",id:"__BVID__168__BV_toggle_",children:"Load more"})}),Object(o.jsx)("div",{style:{height:1,backgroundColor:"#eee",flex:1}})]}):Object(o.jsx)(o.Fragment,{}),t.map(((e,s)=>{const t=e.message+e.date+e.from+s;return"info"===e.from?Object(o.jsx)(F,{message:e.message},t):+e.from!==+n.id?Object(o.jsx)(D,{onUserClicked:()=>r(e.from),message:e.message,date:e.date,user:l[e.from]},t):Object(o.jsx)(W,{username:l[e.from]?l[e.from].username:"",message:e.message,date:e.date},t)}))]})})]})};var A=e=>{let{message:s,setMessage:t,onSubmit:a}=e;return Object(o.jsx)("div",{className:"p-3 chat-input-section",children:Object(o.jsxs)("form",{className:"row",onSubmit:a,children:[Object(o.jsx)("div",{className:"col",children:Object(o.jsx)("div",{className:"position-relative",children:Object(o.jsx)("input",{value:s,onChange:e=>t(e.target.value),type:"text",placeholder:"Enter Message...",className:"form-control chat-input"})})}),Object(o.jsx)("div",{className:"col-auto",children:Object(o.jsxs)("button",{type:"submit",className:"btn btn-primary btn-rounded chat-send w-md",children:[Object(o.jsx)("span",{className:"d-none d-sm-inline-block mr-2",children:"Send"}),Object(o.jsx)("svg",{width:13,height:13,viewBox:"0 0 24 24",tabIndex:-1,children:Object(o.jsx)("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z",fill:"white"})})]})})]})})};var V=e=>{const[s,t]=h(),c=Object(a.useRef)(null),n=s.rooms[s.currentRoom],r=null===n||void 0===n?void 0:n.id,o=null===n||void 0===n?void 0:n.messages,[l,i]=Object(a.useState)(""),d=Object(a.useCallback)((()=>{setTimeout((()=>{c.current&&(c.current.scrollTop=0)}),0)}),[]),m=Object(a.useCallback)((()=>{c.current&&c.current.scrollTo({top:c.current.scrollHeight})}),[]);Object(a.useEffect)((()=>{m()}),[o,m]);const j=Object(a.useCallback)((function(){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];y(r,arguments.length>0&&void 0!==arguments[0]?arguments[0]:0).then((async a=>{await w(s.users,t,a),t({type:e?"prepend messages":"set messages",payload:{id:r,messages:a}}),e?setTimeout((()=>{d()}),10):m()}))}),[t,r,m,d,s.users]);Object(a.useEffect)((()=>{void 0!==r&&void 0===o&&j()}),[o,t,r,s.users,s,m,j]),Object(a.useEffect)((()=>{c.current&&m()}),[m,r]);return{onLoadMoreMessages:Object(a.useCallback)((()=>{j(n.offset,!0)}),[j,n]),onUserClicked:async a=>{const c=s.users[a];let n=c.room;if(void 0===n){const s=await(async(e,s)=>f.a.post(v("/room"),{user1:e,user2:s}).then((e=>e.data)))(a,e.id);n=s.id,t({type:"set user",payload:{...c,room:n}}),t({type:"add room",payload:{id:n,name:N(s.names,e.username)}})}t({type:"set current room",payload:n})},message:l,setMessage:i,dispatch:t,room:n,rooms:s.rooms,currentRoom:s.currentRoom,messageListElement:c,roomId:r,users:s.users,messages:o}};function q(e){let{onLogOut:s,user:t,onMessageSend:a}=e;const{onLoadMoreMessages:c,onUserClicked:n,message:r,setMessage:l,rooms:i,room:d,currentRoom:m,dispatch:j,messageListElement:u,roomId:b,messages:h,users:x}=V(t);return Object(o.jsx)("div",{className:"container py-5 px-4",children:Object(o.jsxs)("div",{className:"chat-body row overflow-hidden shadow bg-light rounded",children:[Object(o.jsx)("div",{className:"col-4 px-0",children:Object(o.jsx)(B,{user:t,onLogOut:s,rooms:i,currentRoom:m,dispatch:j})}),Object(o.jsxs)("div",{className:"col-8 px-0 flex-column bg-white rounded-lg",children:[Object(o.jsx)("div",{className:"px-4 py-4",style:{borderBottom:"1px solid #eee"},children:Object(o.jsx)("h2",{className:"font-size-15 mb-0",children:d?d.name:"Room"})}),Object(o.jsx)(J,{messageListElement:u,messages:h,room:d,onLoadMoreMessages:c,user:t,onUserClicked:n,users:x}),Object(o.jsx)(A,{message:r,setMessage:l,onSubmit:e=>{e.preventDefault(),a(r.trim(),b),l(""),u.current.scrollTop=u.current.scrollHeight}})]})]})})}function G(){return Object(o.jsx)("div",{className:"centered-box",children:Object(o.jsx)("div",{className:"spinner-border",role:"status",children:Object(o.jsx)("span",{className:"visually-hidden"})})})}const X=e=>{let{link:s}=e;return Object(o.jsx)("a",{href:s,title:"Github",children:Object(o.jsxs)("svg",{width:24,height:24,viewBox:"0 0 64 64","aria-labelledby":"title","aria-describedby":"desc",role:"img",children:[Object(o.jsx)("path",{"data-name":"layer2",d:"M32 0a32.021 32.021 0 0 0-10.1 62.4c1.6.3 2.2-.7 2.2-1.5v-6c-8.9 1.9-10.8-3.8-10.8-3.8-1.5-3.7-3.6-4.7-3.6-4.7-2.9-2 .2-1.9.2-1.9 3.2.2 4.9 3.3 4.9 3.3 2.9 4.9 7.5 3.5 9.3 2.7a6.93 6.93 0 0 1 2-4.3c-7.1-.8-14.6-3.6-14.6-15.8a12.27 12.27 0 0 1 3.3-8.6 11.965 11.965 0 0 1 .3-8.5s2.7-.9 8.8 3.3a30.873 30.873 0 0 1 8-1.1 30.292 30.292 0 0 1 8 1.1c6.1-4.1 8.8-3.3 8.8-3.3a11.965 11.965 0 0 1 .3 8.5 12.1 12.1 0 0 1 3.3 8.6c0 12.3-7.5 15-14.6 15.8a7.746 7.746 0 0 1 2.2 5.9v8.8c0 .9.6 1.8 2.2 1.5A32.021 32.021 0 0 0 32 0z",fill:"#595F70"}),Object(o.jsx)("path",{"data-name":"layer1",d:"M12.1 45.9c-.1.2-.3.2-.5.1s-.4-.3-.3-.5.3-.2.6-.1c.2.2.3.4.2.5zm1.3 1.5a.589.589 0 0 1-.8-.8.631.631 0 0 1 .7.1.494.494 0 0 1 .1.7zm1.3 1.8a.585.585 0 0 1-.7-.3.6.6 0 0 1 0-.8.585.585 0 0 1 .7.3c.2.3.2.7 0 .8zm1.7 1.8c-.2.2-.5.1-.8-.1-.3-.3-.4-.6-.2-.8a.619.619 0 0 1 .8.1.554.554 0 0 1 .2.8zm2.4 1c-.1.3-.4.4-.8.3s-.6-.4-.5-.7.4-.4.8-.3c.3.2.6.5.5.7zm2.6.2c0 .3-.3.5-.7.5s-.7-.2-.7-.5.3-.5.7-.5c.4.1.7.3.7.5zm2.4-.4q0 .45-.6.6a.691.691 0 0 1-.8-.3q0-.45.6-.6c.5-.1.8.1.8.3z",fill:"#595F70"})]})})};var Z=()=>{const[e,s]=Object(a.useState)(null);return Object(a.useEffect)((()=>{f.a.get(v("/links")).then((e=>e.data)).catch((e=>null)).then(s)}),[]),Object(o.jsxs)("nav",{className:"navbar navbar-expand-lg navbar-light bg-white",children:[Object(o.jsx)("span",{className:"navbar-brand",children:"Redis chat demo"}),null!==e?Object(o.jsx)("span",{className:"navbar-text",children:e.github&&Object(o.jsx)(X,{link:e.github})}):Object(o.jsx)(o.Fragment,{})]})},K=t(42),Q=t.n(K);const Y=(e,s,t)=>{s({type:"set user",payload:e}),void 0!==t&&s({type:"append message",payload:{id:"0",message:{date:1e4*Math.random(),from:"info",message:t}}})},$=(e,s,t)=>t({type:"add room",payload:{id:e.id,name:N(e.names,s)}}),ee=(e,s)=>{s({type:"make user online",payload:e.from}),s({type:"append message",payload:{id:void 0===e.roomId?"0":e.roomId,message:e}})},se=(e,s)=>{const[t,c]=Object(a.useState)(!1),n=Object(a.useRef)(null),r=Object(a.useRef)(null),o=n.current;return Object(a.useEffect)((()=>{null===e?(null!==o&&o.disconnect(),c(!1),null!==r.current&&(r.current.close(),r.current=null)):(null===r.current&&(r.current=new EventSource(v("/stream")),r.current.onmessage=function(t){const{type:a,data:c}=JSON.parse(t.data);switch(a){case"user.connected":Y(c,s,"".concat(c.username," connected"));break;case"user.disconnected":Y(c,s,"".concat(c.username," left"));break;case"show.room":$(c,e.username,s);break;case"message":ee(c,s)}}),null!==o?o.connect():n.current=Q()(),c(!0))}),[e,o,s]),Object(a.useEffect)((()=>{t&&e?(o.on("user.connected",(e=>Y(e,s,"".concat(e.username," connected")))),o.on("user.disconnected",(e=>Y(e,s,"".concat(e.username," left")))),o.on("show.room",(t=>{$(t,e.username,s)})),o.on("message",(e=>{ee(e,s)}))):o&&(o.off("user.connected"),o.off("user.disconnected"),o.off("user.room"),o.off("message"))}),[t,e,s,o]),[o,t]},te=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e=>{},s=arguments.length>1?arguments[1]:void 0;const[t,c]=Object(a.useState)(!0),[n,r]=Object(a.useState)(null);return Object(a.useEffect)((()=>{t&&f.a.get(v("/me")).then((e=>e.data)).catch((e=>null)).then((s=>{r(s),c(!1),e(s)}))}),[e,t]),{user:n,onLogIn:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};t(null),a(!0),((e,s)=>f.a.post(v("/login"),{username:e,password:s}).then((e=>e.data)).catch((e=>{throw new Error(e.response&&e.response.data&&e.response.data.message)})))(e,s).then((e=>{r(e)})).catch((e=>t(e.message))).finally((()=>a(!1)))},onLogOut:async()=>{f.a.post(v("/logout")).then((()=>{r(null),s({type:"clear"}),c(!0)}))},loading:t}},ae=()=>{const[e,s]=x(),t=Object(a.useCallback)((t=>{null!==t&&(e.users[t.id]||s({type:"set user",payload:{...t,online:!0}}))}),[s,e.users]),{user:c,onLogIn:n,onLogOut:r,loading:o}=te(t,s),[l,i]=se(c,s);Object(a.useEffect)((()=>{if(null!==c)if(i){const t=[];Object.keys(e.rooms).forEach((s=>{const a=e.rooms[s];a.connected||(t.push({...a,connected:!0}),l.emit("room.join",a.id))})),0!==t.length&&s({type:"set rooms",payload:t})}else{const t=[];Object.keys(e.rooms).forEach((s=>{const a=e.rooms[s];a.connected&&t.push({...a,connected:!1})})),0!==t.length&&s({type:"set rooms",payload:t})}}),[c,i,s,l,e.rooms,e.users]),Object(a.useEffect)((()=>{0===Object.values(e.rooms).length&&null!==c&&(f.a.get(v("/users/online")).then((e=>e.data)).then((e=>{s({type:"append users",payload:e})})),(async e=>f.a.get(v("/rooms/".concat(e))).then((e=>e.data)))(c.id).then((e=>{const t=[];e.forEach((e=>{let{id:s,names:a}=e;t.push({id:s,name:N(a,c.username)})})),s({type:"set rooms",payload:t}),s({type:"set current room",payload:"0"})})))}),[s,e.rooms,c]);const d=Object(a.useCallback)(((e,s)=>{"string"===typeof e&&0!==e.trim().length&&(l||console.error("Couldn't send message"),l.emit("message",{roomId:s,message:e,from:c.id,date:p()(new Date).unix()}))}),[c,l]);return{loading:o,user:c,state:e,dispatch:s,onLogIn:n,onMessageSend:d,onLogOut:r}};var ce=()=>{const{loading:e,user:s,state:t,dispatch:a,onLogIn:c,onMessageSend:n,onLogOut:r}=ae();if(e)return Object(o.jsx)(G,{});const l=!s;return Object(o.jsx)(b.Provider,{value:[t,a],children:Object(o.jsxs)("div",{className:"full-height ".concat(l?"bg-light":""),style:{backgroundColor:l?void 0:"#495057"},children:[Object(o.jsx)(Z,{}),l?Object(o.jsx)(d,{onLogIn:c}):Object(o.jsx)(q,{user:s,onMessageSend:n,onLogOut:r})]})})};n.a.render(Object(o.jsx)(ce,{}),document.getElementById("root"))}},[[99,1,2]]]);
//# sourceMappingURL=main.fde18e6b.chunk.js.map